<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Distributed password cracking system for security professionals"><meta name=author content=ZerkerEOD><link href=https://zerkereod.github.io/krakenhashes/dev/admin-guide/system-setup/ssl-tls-provided-mode/ rel=canonical><link rel=icon href=../../../assets/favicon.ico><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.7.1"><title>Provided Certificate Mode Guide - KrakenHashes Documentation</title><link rel=stylesheet href=../../../assets/stylesheets/main.484c7ddc.min.css><link rel=stylesheet href=../../../assets/stylesheets/palette.ab4e12ef.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../../css/timeago.css><link rel=stylesheet href=../../../stylesheets/extra.css><script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=slate data-md-color-primary=red data-md-color-accent=red> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#provided-certificate-mode-guide class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <div data-md-color-scheme=default data-md-component=outdated hidden> </div> <header class="md-header md-header--shadow md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../../.. title="KrakenHashes Documentation" class="md-header__button md-logo" aria-label="KrakenHashes Documentation" data-md-component=logo> <img src=../../../assets/logo.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> KrakenHashes Documentation </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Provided Certificate Mode Guide </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=slate data-md-color-primary=red data-md-color-accent=red aria-label="Switch to light mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> <input class=md-option data-md-color-media data-md-color-scheme=default data-md-color-primary=red data-md-color-accent=red aria-label="Switch to dark mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" title=Share aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/ZerkerEOD/krakenhashes title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </div> <div class=md-source__repository> ZerkerEOD/krakenhashes </div> </a> </div> </nav> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../../../getting-started/ class=md-tabs__link> Getting Started </a> </li> <li class=md-tabs__item> <a href=../../../user-guide/ class=md-tabs__link> User Guide </a> </li> <li class=md-tabs__item> <a href=../../../user-api/ class=md-tabs__link> User API </a> </li> <li class=md-tabs__item> <a href=../../ class=md-tabs__link> Admin Guide </a> </li> <li class=md-tabs__item> <a href=../../../agent-guide/ class=md-tabs__link> Agent Guide </a> </li> <li class=md-tabs__item> <a href=../../../deployment/ class=md-tabs__link> Deployment </a> </li> <li class=md-tabs__item> <a href=../../../developer/ class=md-tabs__link> Developer Guide </a> </li> <li class=md-tabs__item> <a href=../../../reference/ class=md-tabs__link> Reference </a> </li> <li class=md-tabs__item> <a href=../../../troubleshooting/potfile-issues/ class=md-tabs__link> Troubleshooting </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../.. title="KrakenHashes Documentation" class="md-nav__button md-logo" aria-label="KrakenHashes Documentation" data-md-component=logo> <img src=../../../assets/logo.png alt=logo> </a> KrakenHashes Documentation </label> <div class=md-nav__source> <a href=https://github.com/ZerkerEOD/krakenhashes title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </div> <div class=md-source__repository> ZerkerEOD/krakenhashes </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../.. class=md-nav__link> <span class=md-ellipsis> Home </span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../getting-started/ class=md-nav__link> <span class=md-ellipsis> Getting Started </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../user-guide/ class=md-nav__link> <span class=md-ellipsis> User Guide </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../user-api/ class=md-nav__link> <span class=md-ellipsis> User API </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../ class=md-nav__link> <span class=md-ellipsis> Admin Guide </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../agent-guide/ class=md-nav__link> <span class=md-ellipsis> Agent Guide </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../deployment/ class=md-nav__link> <span class=md-ellipsis> Deployment </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../developer/ class=md-nav__link> <span class=md-ellipsis> Developer Guide </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../reference/ class=md-nav__link> <span class=md-ellipsis> Reference </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../troubleshooting/potfile-issues/ class=md-nav__link> <span class=md-ellipsis> Troubleshooting </span> <span class="md-nav__icon md-icon"></span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=provided-certificate-mode-guide>Provided Certificate Mode Guide<a class=headerlink href=#provided-certificate-mode-guide title="Permanent link">&para;</a></h1> <p>This guide explains how to use the "provided" TLS mode in KrakenHashes, which allows you to bring your own SSL/TLS certificates from any certificate authority (CA).</p> <h2 id=overview>Overview<a class=headerlink href=#overview title="Permanent link">&para;</a></h2> <p>Provided mode is ideal when you: - Have existing certificates from a commercial CA (DigiCert, Sectigo, etc.) - Use an internal PKI (Active Directory Certificate Services, OpenSSL CA, etc.) - Obtained certificates from Let's Encrypt externally - Have any other trusted certificates you want to use</p> <h3 id=how-it-works>How It Works<a class=headerlink href=#how-it-works title="Permanent link">&para;</a></h3> <p>KrakenHashes will: 1. Load your server certificate and private key 2. Automatically extract the CA certificate from your certificate chain 3. Serve the CA certificate to agents for trust verification 4. Use your certificates for all HTTPS/WSS connections</p> <h2 id=quick-start>Quick Start<a class=headerlink href=#quick-start title="Permanent link">&para;</a></h2> <h3 id=minimum-configuration>Minimum Configuration<a class=headerlink href=#minimum-configuration title="Permanent link">&para;</a></h3> <div class="language-bash highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nv>KH_TLS_MODE</span><span class=o>=</span>provided
</span><span id=__span-0-2><a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a><span class=nv>KH_CERT_FILE</span><span class=o>=</span>/path/to/server.crt
</span><span id=__span-0-3><a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a><span class=nv>KH_KEY_FILE</span><span class=o>=</span>/path/to/server.key
</span></code></pre></div> <p>The CA certificate will be automatically extracted from your certificate chain.</p> <h3 id=with-explicit-ca>With Explicit CA<a class=headerlink href=#with-explicit-ca title="Permanent link">&para;</a></h3> <div class="language-bash highlight"><pre><span></span><code><span id=__span-1-1><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a><span class=nv>KH_TLS_MODE</span><span class=o>=</span>provided
</span><span id=__span-1-2><a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a><span class=nv>KH_CERT_FILE</span><span class=o>=</span>/path/to/server.crt
</span><span id=__span-1-3><a id=__codelineno-1-3 name=__codelineno-1-3 href=#__codelineno-1-3></a><span class=nv>KH_KEY_FILE</span><span class=o>=</span>/path/to/server.key
</span><span id=__span-1-4><a id=__codelineno-1-4 name=__codelineno-1-4 href=#__codelineno-1-4></a><span class=nv>KH_CA_FILE</span><span class=o>=</span>/path/to/ca.crt
</span></code></pre></div> <p>Explicitly specify the CA certificate to override auto-detection.</p> <h2 id=certificate-requirements>Certificate Requirements<a class=headerlink href=#certificate-requirements title="Permanent link">&para;</a></h2> <h3 id=file-format>File Format<a class=headerlink href=#file-format title="Permanent link">&para;</a></h3> <p>All certificates must be in PEM format:</p> <div class="language-text highlight"><pre><span></span><code><span id=__span-2-1><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a>-----BEGIN CERTIFICATE-----
</span><span id=__span-2-2><a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a>MIIDXTCCAkWgAwIBAgIJAKZ...
</span><span id=__span-2-3><a id=__codelineno-2-3 name=__codelineno-2-3 href=#__codelineno-2-3></a>...
</span><span id=__span-2-4><a id=__codelineno-2-4 name=__codelineno-2-4 href=#__codelineno-2-4></a>-----END CERTIFICATE-----
</span></code></pre></div> <h3 id=certificate-chain>Certificate Chain<a class=headerlink href=#certificate-chain title="Permanent link">&para;</a></h3> <p>Your server certificate file can contain: - <strong>Single certificate</strong> (leaf only) - for self-signed or when chain is provided separately - <strong>Full chain</strong> (leaf + intermediates) - recommended for maximum compatibility - <strong>Complete chain</strong> (leaf + intermediates + root) - works but root usually not needed</p> <h2 id=common-scenarios>Common Scenarios<a class=headerlink href=#common-scenarios title="Permanent link">&para;</a></h2> <h3 id=scenario-1-lets-encrypt-external-certbot>Scenario 1: Let's Encrypt (External Certbot)<a class=headerlink href=#scenario-1-lets-encrypt-external-certbot title="Permanent link">&para;</a></h3> <p>If you obtained Let's Encrypt certificates using certbot on another machine or manually:</p> <p><strong>Files from certbot:</strong> - <code>fullchain.pem</code> - Contains your certificate + Let's Encrypt intermediate - <code>privkey.pem</code> - Your private key - <code>chain.pem</code> - Let's Encrypt intermediate only</p> <p><strong>Configuration:</strong> <div class="language-bash highlight"><pre><span></span><code><span id=__span-3-1><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a><span class=nv>KH_TLS_MODE</span><span class=o>=</span>provided
</span><span id=__span-3-2><a id=__codelineno-3-2 name=__codelineno-3-2 href=#__codelineno-3-2></a><span class=nv>KH_CERT_FILE</span><span class=o>=</span>/path/to/fullchain.pem
</span><span id=__span-3-3><a id=__codelineno-3-3 name=__codelineno-3-3 href=#__codelineno-3-3></a><span class=nv>KH_KEY_FILE</span><span class=o>=</span>/path/to/privkey.pem
</span></code></pre></div></p> <p>The Let's Encrypt intermediate will be auto-extracted from fullchain.pem for agent trust.</p> <p><strong>Certificate Renewal:</strong> When you renew with certbot, simply replace the files and restart KrakenHashes. Agents will continue to trust the new certificate because it's signed by the same CA.</p> <h3 id=scenario-2-commercial-ca-digicert-sectigo-etc>Scenario 2: Commercial CA (DigiCert, Sectigo, etc.)<a class=headerlink href=#scenario-2-commercial-ca-digicert-sectigo-etc title="Permanent link">&para;</a></h3> <p><strong>Files from CA:</strong> - <code>server.crt</code> - Your server certificate - <code>server.key</code> - Your private key - <code>intermediate.crt</code> - CA intermediate certificate - <code>root.crt</code> - CA root certificate</p> <p><strong>Option A: Use full chain file</strong></p> <p>Combine certificates into a chain file: <div class="language-bash highlight"><pre><span></span><code><span id=__span-4-1><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a>cat<span class=w> </span>server.crt<span class=w> </span>intermediate.crt<span class=w> </span>root.crt<span class=w> </span>&gt;<span class=w> </span>fullchain.crt
</span></code></pre></div></p> <p>Configuration: <div class="language-bash highlight"><pre><span></span><code><span id=__span-5-1><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a><span class=nv>KH_TLS_MODE</span><span class=o>=</span>provided
</span><span id=__span-5-2><a id=__codelineno-5-2 name=__codelineno-5-2 href=#__codelineno-5-2></a><span class=nv>KH_CERT_FILE</span><span class=o>=</span>/path/to/fullchain.crt
</span><span id=__span-5-3><a id=__codelineno-5-3 name=__codelineno-5-3 href=#__codelineno-5-3></a><span class=nv>KH_KEY_FILE</span><span class=o>=</span>/path/to/server.key
</span></code></pre></div></p> <p><strong>Option B: Specify CA separately</strong></p> <p>Configuration: <div class="language-bash highlight"><pre><span></span><code><span id=__span-6-1><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a><span class=nv>KH_TLS_MODE</span><span class=o>=</span>provided
</span><span id=__span-6-2><a id=__codelineno-6-2 name=__codelineno-6-2 href=#__codelineno-6-2></a><span class=nv>KH_CERT_FILE</span><span class=o>=</span>/path/to/server.crt
</span><span id=__span-6-3><a id=__codelineno-6-3 name=__codelineno-6-3 href=#__codelineno-6-3></a><span class=nv>KH_KEY_FILE</span><span class=o>=</span>/path/to/server.key
</span><span id=__span-6-4><a id=__codelineno-6-4 name=__codelineno-6-4 href=#__codelineno-6-4></a><span class=nv>KH_CA_FILE</span><span class=o>=</span>/path/to/root.crt
</span></code></pre></div></p> <h3 id=scenario-3-internal-pki>Scenario 3: Internal PKI<a class=headerlink href=#scenario-3-internal-pki title="Permanent link">&para;</a></h3> <p>For corporate or lab environments with an internal certificate authority:</p> <p><strong>Files:</strong> - <code>kraken-server.crt</code> - Your server certificate - <code>kraken-server.key</code> - Your private key - <code>internal-ca.crt</code> - Your internal CA root certificate</p> <p><strong>Configuration:</strong> <div class="language-bash highlight"><pre><span></span><code><span id=__span-7-1><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a><span class=nv>KH_TLS_MODE</span><span class=o>=</span>provided
</span><span id=__span-7-2><a id=__codelineno-7-2 name=__codelineno-7-2 href=#__codelineno-7-2></a><span class=nv>KH_CERT_FILE</span><span class=o>=</span>/path/to/kraken-server.crt
</span><span id=__span-7-3><a id=__codelineno-7-3 name=__codelineno-7-3 href=#__codelineno-7-3></a><span class=nv>KH_KEY_FILE</span><span class=o>=</span>/path/to/kraken-server.key
</span><span id=__span-7-4><a id=__codelineno-7-4 name=__codelineno-7-4 href=#__codelineno-7-4></a><span class=nv>KH_CA_FILE</span><span class=o>=</span>/path/to/internal-ca.crt
</span></code></pre></div></p> <p><strong>Agent Trust:</strong> Agents will download <code>internal-ca.crt</code> and use it to verify the server's identity. This works whether your internal PKI uses: - Active Directory Certificate Services - OpenSSL-based CA - HashiCorp Vault PKI - Smallstep CA - Any other PKI infrastructure</p> <h3 id=scenario-4-self-signed-certificate>Scenario 4: Self-Signed Certificate<a class=headerlink href=#scenario-4-self-signed-certificate title="Permanent link">&para;</a></h3> <p>If you have a self-signed certificate created outside of KrakenHashes:</p> <p><strong>Configuration:</strong> <div class="language-bash highlight"><pre><span></span><code><span id=__span-8-1><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a><span class=nv>KH_TLS_MODE</span><span class=o>=</span>provided
</span><span id=__span-8-2><a id=__codelineno-8-2 name=__codelineno-8-2 href=#__codelineno-8-2></a><span class=nv>KH_CERT_FILE</span><span class=o>=</span>/path/to/self-signed.crt
</span><span id=__span-8-3><a id=__codelineno-8-3 name=__codelineno-8-3 href=#__codelineno-8-3></a><span class=nv>KH_KEY_FILE</span><span class=o>=</span>/path/to/self-signed.key
</span></code></pre></div></p> <p>Since it's self-signed, the certificate itself will be used as the CA for agent trust.</p> <p><strong>Note:</strong> For most self-signed use cases, use <code>KH_TLS_MODE=self-signed</code> instead, which handles generation automatically.</p> <h2 id=smart-ca-extraction>Smart CA Extraction<a class=headerlink href=#smart-ca-extraction title="Permanent link">&para;</a></h2> <p>KrakenHashes automatically determines which certificate to use as the CA for agent trust:</p> <h3 id=priority-1-explicit-ca-file>Priority 1: Explicit CA File<a class=headerlink href=#priority-1-explicit-ca-file title="Permanent link">&para;</a></h3> <p>If <code>KH_CA_FILE</code> is set, that certificate is always used.</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-9-1><a id=__codelineno-9-1 name=__codelineno-9-1 href=#__codelineno-9-1></a><span class=nv>KH_CA_FILE</span><span class=o>=</span>/path/to/specific-ca.crt<span class=w>  </span><span class=c1># Always takes precedence</span>
</span></code></pre></div> <h3 id=priority-2-extract-from-chain>Priority 2: Extract from Chain<a class=headerlink href=#priority-2-extract-from-chain title="Permanent link">&para;</a></h3> <p>If your server certificate file contains multiple certificates:</p> <div class="language-text highlight"><pre><span></span><code><span id=__span-10-1><a id=__codelineno-10-1 name=__codelineno-10-1 href=#__codelineno-10-1></a>-----BEGIN CERTIFICATE-----
</span><span id=__span-10-2><a id=__codelineno-10-2 name=__codelineno-10-2 href=#__codelineno-10-2></a>[Leaf Certificate - server.example.com]
</span><span id=__span-10-3><a id=__codelineno-10-3 name=__codelineno-10-3 href=#__codelineno-10-3></a>-----END CERTIFICATE-----
</span><span id=__span-10-4><a id=__codelineno-10-4 name=__codelineno-10-4 href=#__codelineno-10-4></a>-----BEGIN CERTIFICATE-----
</span><span id=__span-10-5><a id=__codelineno-10-5 name=__codelineno-10-5 href=#__codelineno-10-5></a>[Intermediate CA]
</span><span id=__span-10-6><a id=__codelineno-10-6 name=__codelineno-10-6 href=#__codelineno-10-6></a>-----END CERTIFICATE-----
</span><span id=__span-10-7><a id=__codelineno-10-7 name=__codelineno-10-7 href=#__codelineno-10-7></a>-----BEGIN CERTIFICATE-----
</span><span id=__span-10-8><a id=__codelineno-10-8 name=__codelineno-10-8 href=#__codelineno-10-8></a>[Root CA]
</span><span id=__span-10-9><a id=__codelineno-10-9 name=__codelineno-10-9 href=#__codelineno-10-9></a>-----END CERTIFICATE-----
</span></code></pre></div> <p>The <strong>last certificate</strong> in the chain is used as the CA for agents.</p> <h3 id=priority-3-self-signed-detection>Priority 3: Self-Signed Detection<a class=headerlink href=#priority-3-self-signed-detection title="Permanent link">&para;</a></h3> <p>If your server certificate file contains only one certificate and no <code>KH_CA_FILE</code> is specified, that certificate is used as both the server cert and the CA (self-signed scenario).</p> <h2 id=certificate-renewal>Certificate Renewal<a class=headerlink href=#certificate-renewal title="Permanent link">&para;</a></h2> <h3 id=transparent-renewal>Transparent Renewal<a class=headerlink href=#transparent-renewal title="Permanent link">&para;</a></h3> <p>One of the key advantages of using CA-based trust: <strong>certificate renewal is transparent to agents</strong>.</p> <p>When your server certificate expires and you get a new one:</p> <ol> <li>Replace the certificate files on the server</li> <li>Restart KrakenHashes</li> <li>Agents continue working <strong>without any updates</strong></li> </ol> <p>This works because: - Agents trust the CA that signed your certificate - The new certificate is signed by the same CA - Therefore, agents automatically trust the new certificate</p> <p><strong>Example with Let's Encrypt (90-day certificates):</strong> <div class="language-bash highlight"><pre><span></span><code><span id=__span-11-1><a id=__codelineno-11-1 name=__codelineno-11-1 href=#__codelineno-11-1></a><span class=c1># Initial setup</span>
</span><span id=__span-11-2><a id=__codelineno-11-2 name=__codelineno-11-2 href=#__codelineno-11-2></a><span class=nv>KH_CERT_FILE</span><span class=o>=</span>/etc/letsencrypt/live/example.com/fullchain.pem
</span><span id=__span-11-3><a id=__codelineno-11-3 name=__codelineno-11-3 href=#__codelineno-11-3></a>
</span><span id=__span-11-4><a id=__codelineno-11-4 name=__codelineno-11-4 href=#__codelineno-11-4></a><span class=c1># After 90 days, certbot renews automatically</span>
</span><span id=__span-11-5><a id=__codelineno-11-5 name=__codelineno-11-5 href=#__codelineno-11-5></a><span class=c1># Restart KrakenHashes to load new cert</span>
</span><span id=__span-11-6><a id=__codelineno-11-6 name=__codelineno-11-6 href=#__codelineno-11-6></a>docker-compose<span class=w> </span>restart<span class=w> </span>krakenhashes
</span><span id=__span-11-7><a id=__codelineno-11-7 name=__codelineno-11-7 href=#__codelineno-11-7></a>
</span><span id=__span-11-8><a id=__codelineno-11-8 name=__codelineno-11-8 href=#__codelineno-11-8></a><span class=c1># All agents continue working - no updates needed!</span>
</span></code></pre></div></p> <h3 id=certificate-pinning-warning>Certificate Pinning Warning<a class=headerlink href=#certificate-pinning-warning title="Permanent link">&para;</a></h3> <p>Some may consider using "certificate pinning" (trusting the server certificate directly instead of the CA). <strong>This is strongly discouraged</strong> because:</p> <p>❌ Every time the server certificate renews, every agent must be manually updated ❌ Completely breaks automated renewal workflows ❌ Operational nightmare with short-lived certificates (Let's Encrypt 90 days)</p> <p>CA-based trust is the industry standard for good reason.</p> <h2 id=file-permissions>File Permissions<a class=headerlink href=#file-permissions title="Permanent link">&para;</a></h2> <p>For security, ensure proper file permissions:</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-12-1><a id=__codelineno-12-1 name=__codelineno-12-1 href=#__codelineno-12-1></a><span class=c1># Server certificate (public) - readable by all</span>
</span><span id=__span-12-2><a id=__codelineno-12-2 name=__codelineno-12-2 href=#__codelineno-12-2></a>chmod<span class=w> </span><span class=m>644</span><span class=w> </span>/path/to/server.crt
</span><span id=__span-12-3><a id=__codelineno-12-3 name=__codelineno-12-3 href=#__codelineno-12-3></a>chmod<span class=w> </span><span class=m>644</span><span class=w> </span>/path/to/ca.crt
</span><span id=__span-12-4><a id=__codelineno-12-4 name=__codelineno-12-4 href=#__codelineno-12-4></a>
</span><span id=__span-12-5><a id=__codelineno-12-5 name=__codelineno-12-5 href=#__codelineno-12-5></a><span class=c1># Private key (secret) - readable only by owner</span>
</span><span id=__span-12-6><a id=__codelineno-12-6 name=__codelineno-12-6 href=#__codelineno-12-6></a>chmod<span class=w> </span><span class=m>600</span><span class=w> </span>/path/to/server.key
</span><span id=__span-12-7><a id=__codelineno-12-7 name=__codelineno-12-7 href=#__codelineno-12-7></a>chown<span class=w> </span>krakenhashes:krakenhashes<span class=w> </span>/path/to/server.key
</span></code></pre></div> <h2 id=validation>Validation<a class=headerlink href=#validation title="Permanent link">&para;</a></h2> <p>After configuring provided mode, verify the setup:</p> <h3 id=1-check-backend-logs>1. Check Backend Logs<a class=headerlink href=#1-check-backend-logs title="Permanent link">&para;</a></h3> <p>Look for successful initialization: <div class="language-text highlight"><pre><span></span><code><span id=__span-13-1><a id=__codelineno-13-1 name=__codelineno-13-1 href=#__codelineno-13-1></a>INFO  Initializing user-provided certificate mode
</span><span id=__span-13-2><a id=__codelineno-13-2 name=__codelineno-13-2 href=#__codelineno-13-2></a>INFO  Loaded 2 certificate(s) from chain
</span><span id=__span-13-3><a id=__codelineno-13-3 name=__codelineno-13-3 href=#__codelineno-13-3></a>INFO  Server certificate subject: CN=kraken.example.com
</span><span id=__span-13-4><a id=__codelineno-13-4 name=__codelineno-13-4 href=#__codelineno-13-4></a>INFO  Server certificate validity: 2025-01-01 to 2026-01-01
</span><span id=__span-13-5><a id=__codelineno-13-5 name=__codelineno-13-5 href=#__codelineno-13-5></a>INFO  Auto-extracted CA from chain (cert 2/2): CN=Example CA
</span><span id=__span-13-6><a id=__codelineno-13-6 name=__codelineno-13-6 href=#__codelineno-13-6></a>INFO  Provided certificate mode initialized successfully
</span></code></pre></div></p> <h3 id=2-verify-ca-certificate-endpoint>2. Verify CA Certificate Endpoint<a class=headerlink href=#2-verify-ca-certificate-endpoint title="Permanent link">&para;</a></h3> <p>Agents download the CA from <code>http://server:1337/ca.crt</code>. Verify it's accessible:</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-14-1><a id=__codelineno-14-1 name=__codelineno-14-1 href=#__codelineno-14-1></a>curl<span class=w> </span>http://your-server:1337/ca.crt
</span></code></pre></div> <p>You should see a PEM-encoded certificate.</p> <h3 id=3-test-agent-connection>3. Test Agent Connection<a class=headerlink href=#3-test-agent-connection title="Permanent link">&para;</a></h3> <p>Start an agent and verify it connects successfully. Check agent logs for: <div class="language-text highlight"><pre><span></span><code><span id=__span-15-1><a id=__codelineno-15-1 name=__codelineno-15-1 href=#__codelineno-15-1></a>INFO  Successfully loaded CA certificate from disk
</span><span id=__span-15-2><a id=__codelineno-15-2 name=__codelineno-15-2 href=#__codelineno-15-2></a>INFO  WebSocket connection established
</span></code></pre></div></p> <h3 id=4-verify-certificate-chain>4. Verify Certificate Chain<a class=headerlink href=#4-verify-certificate-chain title="Permanent link">&para;</a></h3> <p>Check that the server presents the full certificate chain:</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-16-1><a id=__codelineno-16-1 name=__codelineno-16-1 href=#__codelineno-16-1></a>openssl<span class=w> </span>s_client<span class=w> </span>-connect<span class=w> </span>your-server:31337<span class=w> </span>-showcerts
</span></code></pre></div> <p>You should see multiple certificates in the output (server + intermediates).</p> <h2 id=troubleshooting>Troubleshooting<a class=headerlink href=#troubleshooting title="Permanent link">&para;</a></h2> <h3 id=failed-to-parse-certificate-chain>"Failed to parse certificate chain"<a class=headerlink href=#failed-to-parse-certificate-chain title="Permanent link">&para;</a></h3> <p><strong>Cause:</strong> Certificate file is not in valid PEM format.</p> <p><strong>Solution:</strong> Ensure the file contains PEM-encoded certificates: <div class="language-bash highlight"><pre><span></span><code><span id=__span-17-1><a id=__codelineno-17-1 name=__codelineno-17-1 href=#__codelineno-17-1></a>openssl<span class=w> </span>x509<span class=w> </span>-in<span class=w> </span>server.crt<span class=w> </span>-text<span class=w> </span>-noout
</span></code></pre></div></p> <p>If you have a DER-encoded certificate, convert it: <div class="language-bash highlight"><pre><span></span><code><span id=__span-18-1><a id=__codelineno-18-1 name=__codelineno-18-1 href=#__codelineno-18-1></a>openssl<span class=w> </span>x509<span class=w> </span>-inform<span class=w> </span>DER<span class=w> </span>-in<span class=w> </span>server.der<span class=w> </span>-out<span class=w> </span>server.pem
</span></code></pre></div></p> <h3 id=private-key-does-not-match-certificate>"Private key does not match certificate"<a class=headerlink href=#private-key-does-not-match-certificate title="Permanent link">&para;</a></h3> <p><strong>Cause:</strong> The private key file doesn't correspond to the certificate's public key.</p> <p><strong>Solution:</strong> Verify the key matches: <div class="language-bash highlight"><pre><span></span><code><span id=__span-19-1><a id=__codelineno-19-1 name=__codelineno-19-1 href=#__codelineno-19-1></a><span class=c1># Extract public key from cert</span>
</span><span id=__span-19-2><a id=__codelineno-19-2 name=__codelineno-19-2 href=#__codelineno-19-2></a>openssl<span class=w> </span>x509<span class=w> </span>-in<span class=w> </span>server.crt<span class=w> </span>-pubkey<span class=w> </span>-noout<span class=w> </span>&gt;<span class=w> </span>cert-pubkey.pem
</span><span id=__span-19-3><a id=__codelineno-19-3 name=__codelineno-19-3 href=#__codelineno-19-3></a>
</span><span id=__span-19-4><a id=__codelineno-19-4 name=__codelineno-19-4 href=#__codelineno-19-4></a><span class=c1># Extract public key from private key</span>
</span><span id=__span-19-5><a id=__codelineno-19-5 name=__codelineno-19-5 href=#__codelineno-19-5></a>openssl<span class=w> </span>pkey<span class=w> </span>-in<span class=w> </span>server.key<span class=w> </span>-pubout<span class=w> </span>&gt;<span class=w> </span>key-pubkey.pem
</span><span id=__span-19-6><a id=__codelineno-19-6 name=__codelineno-19-6 href=#__codelineno-19-6></a>
</span><span id=__span-19-7><a id=__codelineno-19-7 name=__codelineno-19-7 href=#__codelineno-19-7></a><span class=c1># Compare - they should be identical</span>
</span><span id=__span-19-8><a id=__codelineno-19-8 name=__codelineno-19-8 href=#__codelineno-19-8></a>diff<span class=w> </span>cert-pubkey.pem<span class=w> </span>key-pubkey.pem
</span></code></pre></div></p> <h3 id=no-valid-certificates-found-in-ca-file>"No valid certificates found in CA file"<a class=headerlink href=#no-valid-certificates-found-in-ca-file title="Permanent link">&para;</a></h3> <p><strong>Cause:</strong> <code>KH_CA_FILE</code> points to an invalid or empty file.</p> <p><strong>Solution:</strong> Verify the CA file is a valid PEM certificate: <div class="language-bash highlight"><pre><span></span><code><span id=__span-20-1><a id=__codelineno-20-1 name=__codelineno-20-1 href=#__codelineno-20-1></a>openssl<span class=w> </span>x509<span class=w> </span>-in<span class=w> </span>ca.crt<span class=w> </span>-text<span class=w> </span>-noout
</span></code></pre></div></p> <h3 id=agents-cant-connect-certificate-verification-failed>Agents Can't Connect - "Certificate Verification Failed"<a class=headerlink href=#agents-cant-connect-certificate-verification-failed title="Permanent link">&para;</a></h3> <p><strong>Cause:</strong> Agents can't verify the server certificate against the CA.</p> <p><strong>Diagnosis:</strong> 1. Check what CA certificate agents downloaded: <div class="language-bash highlight"><pre><span></span><code><span id=__span-21-1><a id=__codelineno-21-1 name=__codelineno-21-1 href=#__codelineno-21-1></a>cat<span class=w> </span>agent/config/ca.crt
</span></code></pre></div></p> <ol> <li>Verify the server cert was issued by that CA: <div class="language-bash highlight"><pre><span></span><code><span id=__span-22-1><a id=__codelineno-22-1 name=__codelineno-22-1 href=#__codelineno-22-1></a>openssl<span class=w> </span>verify<span class=w> </span>-CAfile<span class=w> </span>ca.crt<span class=w> </span>server.crt
</span></code></pre></div></li> </ol> <p><strong>Solution:</strong> Ensure the CA file includes the complete chain needed to verify the server cert.</p> <h3 id=certificate-expired-but-cant-renew>Certificate Expired But Can't Renew<a class=headerlink href=#certificate-expired-but-cant-renew title="Permanent link">&para;</a></h3> <p><strong>Cause:</strong> Certificates expired and you can't get new ones immediately.</p> <p><strong>Temporary Workaround:</strong> Switch to self-signed mode temporarily: <div class="language-bash highlight"><pre><span></span><code><span id=__span-23-1><a id=__codelineno-23-1 name=__codelineno-23-1 href=#__codelineno-23-1></a><span class=nv>KH_TLS_MODE</span><span class=o>=</span>self-signed
</span></code></pre></div></p> <p>Then obtain proper certificates and switch back to provided mode.</p> <h2 id=converting-certificate-formats>Converting Certificate Formats<a class=headerlink href=#converting-certificate-formats title="Permanent link">&para;</a></h2> <h3 id=pkcs12-pfx-p12-to-pem>PKCS#12 (.pfx, .p12) to PEM<a class=headerlink href=#pkcs12-pfx-p12-to-pem title="Permanent link">&para;</a></h3> <p>Many CAs provide certificates in PKCS#12 format:</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-24-1><a id=__codelineno-24-1 name=__codelineno-24-1 href=#__codelineno-24-1></a><span class=c1># Extract certificate</span>
</span><span id=__span-24-2><a id=__codelineno-24-2 name=__codelineno-24-2 href=#__codelineno-24-2></a>openssl<span class=w> </span>pkcs12<span class=w> </span>-in<span class=w> </span>cert.pfx<span class=w> </span>-clcerts<span class=w> </span>-nokeys<span class=w> </span>-out<span class=w> </span>server.crt
</span><span id=__span-24-3><a id=__codelineno-24-3 name=__codelineno-24-3 href=#__codelineno-24-3></a>
</span><span id=__span-24-4><a id=__codelineno-24-4 name=__codelineno-24-4 href=#__codelineno-24-4></a><span class=c1># Extract private key</span>
</span><span id=__span-24-5><a id=__codelineno-24-5 name=__codelineno-24-5 href=#__codelineno-24-5></a>openssl<span class=w> </span>pkcs12<span class=w> </span>-in<span class=w> </span>cert.pfx<span class=w> </span>-nocerts<span class=w> </span>-nodes<span class=w> </span>-out<span class=w> </span>server.key
</span><span id=__span-24-6><a id=__codelineno-24-6 name=__codelineno-24-6 href=#__codelineno-24-6></a>
</span><span id=__span-24-7><a id=__codelineno-24-7 name=__codelineno-24-7 href=#__codelineno-24-7></a><span class=c1># Extract CA chain</span>
</span><span id=__span-24-8><a id=__codelineno-24-8 name=__codelineno-24-8 href=#__codelineno-24-8></a>openssl<span class=w> </span>pkcs12<span class=w> </span>-in<span class=w> </span>cert.pfx<span class=w> </span>-cacerts<span class=w> </span>-nokeys<span class=w> </span>-out<span class=w> </span>ca.crt
</span></code></pre></div> <h3 id=der-to-pem>DER to PEM<a class=headerlink href=#der-to-pem title="Permanent link">&para;</a></h3> <div class="language-bash highlight"><pre><span></span><code><span id=__span-25-1><a id=__codelineno-25-1 name=__codelineno-25-1 href=#__codelineno-25-1></a><span class=c1># Convert certificate</span>
</span><span id=__span-25-2><a id=__codelineno-25-2 name=__codelineno-25-2 href=#__codelineno-25-2></a>openssl<span class=w> </span>x509<span class=w> </span>-inform<span class=w> </span>DER<span class=w> </span>-in<span class=w> </span>server.der<span class=w> </span>-out<span class=w> </span>server.crt
</span><span id=__span-25-3><a id=__codelineno-25-3 name=__codelineno-25-3 href=#__codelineno-25-3></a>
</span><span id=__span-25-4><a id=__codelineno-25-4 name=__codelineno-25-4 href=#__codelineno-25-4></a><span class=c1># Convert private key</span>
</span><span id=__span-25-5><a id=__codelineno-25-5 name=__codelineno-25-5 href=#__codelineno-25-5></a>openssl<span class=w> </span>rsa<span class=w> </span>-inform<span class=w> </span>DER<span class=w> </span>-in<span class=w> </span>server.key.der<span class=w> </span>-out<span class=w> </span>server.key
</span></code></pre></div> <h3 id=combine-separate-certificates-into-chain>Combine Separate Certificates into Chain<a class=headerlink href=#combine-separate-certificates-into-chain title="Permanent link">&para;</a></h3> <div class="language-bash highlight"><pre><span></span><code><span id=__span-26-1><a id=__codelineno-26-1 name=__codelineno-26-1 href=#__codelineno-26-1></a>cat<span class=w> </span>server.crt<span class=w> </span>intermediate.crt<span class=w> </span>root.crt<span class=w> </span>&gt;<span class=w> </span>fullchain.crt
</span></code></pre></div> <h2 id=security-best-practices>Security Best Practices<a class=headerlink href=#security-best-practices title="Permanent link">&para;</a></h2> <h3 id=1-use-strong-private-keys>1. Use Strong Private Keys<a class=headerlink href=#1-use-strong-private-keys title="Permanent link">&para;</a></h3> <p>Minimum 2048-bit RSA or 256-bit ECC: <div class="language-bash highlight"><pre><span></span><code><span id=__span-27-1><a id=__codelineno-27-1 name=__codelineno-27-1 href=#__codelineno-27-1></a><span class=c1># Check key size</span>
</span><span id=__span-27-2><a id=__codelineno-27-2 name=__codelineno-27-2 href=#__codelineno-27-2></a>openssl<span class=w> </span>rsa<span class=w> </span>-in<span class=w> </span>server.key<span class=w> </span>-text<span class=w> </span>-noout<span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span><span class=s2>&quot;Private-Key&quot;</span>
</span></code></pre></div></p> <h3 id=2-protect-private-keys>2. Protect Private Keys<a class=headerlink href=#2-protect-private-keys title="Permanent link">&para;</a></h3> <ul> <li>Store with 600 permissions (owner read/write only)</li> <li>Never commit to version control</li> <li>Use encrypted storage if possible</li> <li>Rotate regularly (annually at minimum)</li> </ul> <h3 id=3-verify-certificate-validity>3. Verify Certificate Validity<a class=headerlink href=#3-verify-certificate-validity title="Permanent link">&para;</a></h3> <p>Before deploying, check: <div class="language-bash highlight"><pre><span></span><code><span id=__span-28-1><a id=__codelineno-28-1 name=__codelineno-28-1 href=#__codelineno-28-1></a>openssl<span class=w> </span>x509<span class=w> </span>-in<span class=w> </span>server.crt<span class=w> </span>-noout<span class=w> </span>-dates
</span><span id=__span-28-2><a id=__codelineno-28-2 name=__codelineno-28-2 href=#__codelineno-28-2></a>openssl<span class=w> </span>x509<span class=w> </span>-in<span class=w> </span>server.crt<span class=w> </span>-noout<span class=w> </span>-subject
</span><span id=__span-28-3><a id=__codelineno-28-3 name=__codelineno-28-3 href=#__codelineno-28-3></a>openssl<span class=w> </span>x509<span class=w> </span>-in<span class=w> </span>server.crt<span class=w> </span>-noout<span class=w> </span>-issuer
</span></code></pre></div></p> <h3 id=4-monitor-expiration>4. Monitor Expiration<a class=headerlink href=#4-monitor-expiration title="Permanent link">&para;</a></h3> <p>Set reminders for certificate renewal well before expiration: <div class="language-bash highlight"><pre><span></span><code><span id=__span-29-1><a id=__codelineno-29-1 name=__codelineno-29-1 href=#__codelineno-29-1></a><span class=c1># Check days until expiration</span>
</span><span id=__span-29-2><a id=__codelineno-29-2 name=__codelineno-29-2 href=#__codelineno-29-2></a>openssl<span class=w> </span>x509<span class=w> </span>-in<span class=w> </span>server.crt<span class=w> </span>-noout<span class=w> </span>-checkend<span class=w> </span><span class=k>$((</span><span class=m>30</span><span class=o>*</span><span class=m>86400</span><span class=k>))</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;Expires in &gt;30 days&quot;</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;WARNING: Expires soon!&quot;</span>
</span></code></pre></div></p> <h3 id=5-use-full-certificate-chains>5. Use Full Certificate Chains<a class=headerlink href=#5-use-full-certificate-chains title="Permanent link">&para;</a></h3> <p>Always include intermediates for maximum client compatibility: <div class="language-bash highlight"><pre><span></span><code><span id=__span-30-1><a id=__codelineno-30-1 name=__codelineno-30-1 href=#__codelineno-30-1></a><span class=c1># Good: Full chain</span>
</span><span id=__span-30-2><a id=__codelineno-30-2 name=__codelineno-30-2 href=#__codelineno-30-2></a>cat<span class=w> </span>server.crt<span class=w> </span>intermediate.crt<span class=w> </span>&gt;<span class=w> </span>fullchain.crt
</span><span id=__span-30-3><a id=__codelineno-30-3 name=__codelineno-30-3 href=#__codelineno-30-3></a>
</span><span id=__span-30-4><a id=__codelineno-30-4 name=__codelineno-30-4 href=#__codelineno-30-4></a><span class=c1># Bad: Server cert only (may fail validation)</span>
</span><span id=__span-30-5><a id=__codelineno-30-5 name=__codelineno-30-5 href=#__codelineno-30-5></a>cp<span class=w> </span>server.crt<span class=w> </span>fullchain.crt
</span></code></pre></div></p> <h2 id=advanced-wildcard-certificates>Advanced: Wildcard Certificates<a class=headerlink href=#advanced-wildcard-certificates title="Permanent link">&para;</a></h2> <p>Wildcard certificates work perfectly with provided mode:</p> <p><strong>Certificate:</strong> <code>*.example.com</code></p> <p><strong>Valid for:</strong> - <code>kraken.example.com</code> - <code>api.example.com</code> - Any <code>*.example.com</code></p> <p><strong>Not valid for:</strong> - <code>example.com</code> (root domain, unless included as SAN) - <code>sub.kraken.example.com</code> (multi-level subdomains)</p> <p><strong>Configuration:</strong> <div class="language-bash highlight"><pre><span></span><code><span id=__span-31-1><a id=__codelineno-31-1 name=__codelineno-31-1 href=#__codelineno-31-1></a><span class=nv>KH_TLS_MODE</span><span class=o>=</span>provided
</span><span id=__span-31-2><a id=__codelineno-31-2 name=__codelineno-31-2 href=#__codelineno-31-2></a><span class=nv>KH_CERT_FILE</span><span class=o>=</span>/path/to/wildcard.crt<span class=w>  </span><span class=c1># *.example.com</span>
</span><span id=__span-31-3><a id=__codelineno-31-3 name=__codelineno-31-3 href=#__codelineno-31-3></a><span class=nv>KH_KEY_FILE</span><span class=o>=</span>/path/to/wildcard.key
</span></code></pre></div></p> <h2 id=migration>Migration<a class=headerlink href=#migration title="Permanent link">&para;</a></h2> <h3 id=from-self-signed-to-provided>From Self-Signed to Provided<a class=headerlink href=#from-self-signed-to-provided title="Permanent link">&para;</a></h3> <ol> <li>Obtain certificates from your CA</li> <li>Update configuration: <div class="language-bash highlight"><pre><span></span><code><span id=__span-32-1><a id=__codelineno-32-1 name=__codelineno-32-1 href=#__codelineno-32-1></a><span class=nv>KH_TLS_MODE</span><span class=o>=</span>provided
</span><span id=__span-32-2><a id=__codelineno-32-2 name=__codelineno-32-2 href=#__codelineno-32-2></a><span class=nv>KH_CERT_FILE</span><span class=o>=</span>/path/to/new-cert.crt
</span><span id=__span-32-3><a id=__codelineno-32-3 name=__codelineno-32-3 href=#__codelineno-32-3></a><span class=nv>KH_KEY_FILE</span><span class=o>=</span>/path/to/new-cert.key
</span></code></pre></div></li> <li>Restart KrakenHashes</li> <li><strong>Important:</strong> Agents will need to download the new CA certificate</li> <li>On each agent machine, remove old CA: <code>rm agent/config/ca.crt</code></li> <li>Restart agents - they'll download the new CA automatically</li> </ol> <h3 id=from-certbot-mode-to-provided>From Certbot Mode to Provided<a class=headerlink href=#from-certbot-mode-to-provided title="Permanent link">&para;</a></h3> <p>If you want to manage Let's Encrypt certificates externally:</p> <ol> <li>Stop using built-in certbot mode</li> <li>Obtain certificates using your preferred method</li> <li>Configure provided mode to use those certificates</li> <li>Agents will continue working (same Let's Encrypt CA)</li> </ol> <h2 id=see-also>See Also<a class=headerlink href=#see-also title="Permanent link">&para;</a></h2> <ul> <li><a href=../ssl-tls-custom-acme/ >Custom ACME Server Guide</a> - Use internal ACME servers with certbot mode</li> <li><a href=../ssl-tls/ >Main SSL/TLS Setup Guide</a> - Overview of all TLS modes</li> <li><a href=../agent-setup.md>Agent Configuration</a> - How agents handle certificates</li> </ul> <aside class=md-source-file> <span class=md-source-file__fact> <span class=md-icon title="Last update"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg> </span> <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-timeago" title="November 5, 2025 13:16:27 UTC"><span class=timeago datetime=2025-11-05T13:16:27+00:00 locale=en></span></span><span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date" title="November 5, 2025 13:16:27 UTC">2025-11-05</span> </span> <span class=md-source-file__fact> <span class=md-icon title=Created> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M14.47 15.08 11 13V7h1.5v5.25l3.08 1.83c-.41.28-.79.62-1.11 1m-1.39 4.84c-.36.05-.71.08-1.08.08-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8c0 .37-.03.72-.08 1.08.69.1 1.33.32 1.92.64.1-.56.16-1.13.16-1.72 0-5.5-4.5-10-10-10S2 6.5 2 12s4.47 10 10 10c.59 0 1.16-.06 1.72-.16-.32-.59-.54-1.23-.64-1.92M18 15v3h-3v2h3v3h2v-3h3v-2h-3v-3z"/></svg> </span> <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-timeago" title="November 5, 2025 13:16:27 UTC"><span class=timeago datetime=2025-11-05T13:16:27+00:00 locale=en></span></span><span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date" title="November 5, 2025 13:16:27 UTC">2025-11-05</span> </span> </aside> </article> </div> <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg> Back to top </button> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://github.com/ZerkerEOD/krakenhashes target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </a> <a href=https://discord.gg/taafA9cSFV target=_blank rel=noopener title=discord.gg class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 576 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M492.5 69.8c-.2-.3-.4-.6-.8-.7-38.1-17.5-78.4-30-119.7-37.1-.4-.1-.8 0-1.1.1s-.6.4-.8.8c-5.5 9.9-10.5 20.2-14.9 30.6-44.6-6.8-89.9-6.8-134.4 0-4.5-10.5-9.5-20.7-15.1-30.6-.2-.3-.5-.6-.8-.8s-.7-.2-1.1-.2C162.5 39 122.2 51.5 84.1 69c-.3.1-.6.4-.8.7C7.1 183.5-13.8 294.6-3.6 404.2c0 .3.1.5.2.8s.3.4.5.6c44.4 32.9 94 58 146.8 74.2.4.1.8.1 1.1 0s.7-.4.9-.7c11.3-15.4 21.4-31.8 30-48.8.1-.2.2-.5.2-.8s0-.5-.1-.8-.2-.5-.4-.6-.4-.3-.7-.4c-15.8-6.1-31.2-13.4-45.9-21.9-.3-.2-.5-.4-.7-.6s-.3-.6-.3-.9 0-.6.2-.9.3-.5.6-.7c3.1-2.3 6.2-4.7 9.1-7.1.3-.2.6-.4.9-.4s.7 0 1 .1c96.2 43.9 200.4 43.9 295.5 0 .3-.1.7-.2 1-.2s.7.2.9.4c2.9 2.4 6 4.9 9.1 7.2.2.2.4.4.6.7s.2.6.2.9-.1.6-.3.9-.4.5-.6.6c-14.7 8.6-30 15.9-45.9 21.8-.2.1-.5.2-.7.4s-.3.4-.4.7-.1.5-.1.8.1.5.2.8c8.8 17 18.8 33.3 30 48.8.2.3.6.6.9.7s.8.1 1.1 0c52.9-16.2 102.6-41.3 147.1-74.2.2-.2.4-.4.5-.6s.2-.5.2-.8c12.3-126.8-20.5-236.9-86.9-334.5zm-302 267.7c-29 0-52.8-26.6-52.8-59.2s23.4-59.2 52.8-59.2c29.7 0 53.3 26.8 52.8 59.2 0 32.7-23.4 59.2-52.8 59.2m195.4 0c-29 0-52.8-26.6-52.8-59.2s23.4-59.2 52.8-59.2c29.7 0 53.3 26.8 52.8 59.2 0 32.7-23.2 59.2-52.8 59.2"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"annotate": null, "base": "../../..", "features": ["navigation.instant", "navigation.tracking", "navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "navigation.expand", "navigation.path", "navigation.prune", "navigation.indexes", "navigation.top", "toc.follow", "toc.integrate", "search.suggest", "search.highlight", "search.share", "header.autohide", "content.code.copy", "content.code.annotate", "content.tabs.link"], "search": "../../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script> <script src=../../../assets/javascripts/bundle.79ae519e.min.js></script> <script src=../../../js/timeago.min.js></script> <script src=../../../js/timeago_mkdocs_material.js></script> <script src=../../../javascripts/extra.js></script> </body> </html>